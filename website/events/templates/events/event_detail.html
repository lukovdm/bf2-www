{% extends 'page.html' %}
{% load cms_tags i18n static events_datetimerange tz %}

{% block pagetitle %}
    {{ object.name }}
    <h4 class="text-center">{% daterange object.start_date object.end_date %}</h4>
{% endblock pagetitle %}

{% block content %}
    <div class="row mb-3">
        <div class="w-100">
            <img src="{{ object.image.url }}" class="rounded img-fluid shadow">
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-4 d-flex align-items-center">
            <i class="bi bi-clock pe-2 fs-3"></i>
            <p class="fw-bold fst-italic fs-6 m-0">
                {% datetimerange object.start_date object.end_date %}
            </p>
        </div>
        <div class="col-4 d-flex align-items-center">
            <i class="bi bi-geo-alt pe-2 fs-3"></i>
            <p class="fw-bold fst-italic fs-6 m-0">{{ object.location }}</p>
        </div>
        <div class="col-4 d-flex align-items-center">
            <i class="bi bi-currency-euro pe-2 fs-3"></i>
            <p class="fw-bold fst-italic fs-6 m-0">
                {% if object.cost %}{{ object.cost }}{% else %}{% trans "free"|capfirst %}{% endif %}
            </p>
        </div>
    </div>
    <div class="row mb-3">
        {% render_placeholder object.description %}
    </div>
    <div class="row mb-3">
        {% if user.is_authenticated %}
            {% if registration %}
                <form action="{% url "events:unregister" object.pk %}" method="post">{% csrf_token %}
                    <button class="btn btn-primary" name="unregister" value="unregister">
                        {% trans "unregister"|capfirst %}
                    </button>
                </form>
            {% else %}
                <form action="{% url "events:register" object.pk %}" method="post">{% csrf_token %}
                    <button class="btn btn-primary" name="register" value="register"
                    {% if object.registration_set.all|length >= object.limit %} disabled>
                        {% trans "Full" %}
                    {% elif object.registration_start and object.registration_start > now %} disabled>
                        {% trans "Not opend" %}
                    {% elif object.registration_end and object.registration_end < now %} disabled>
                        {% trans "Closed" %}
                    {% else %}>
                        {% trans "register"|capfirst %}
                    {% endif %}
                    </button>
                </form>
            {% endif %}
        {% endif %}
    </div>
    <div class="row">
        {% if object.limit %}
            <p class="fw-bold{% if object.registration_set.all|length >= object.limit and registration is None %} text-danger{% endif %}"><i class="bi bi-people fs-5"></i> {{ object.registration_set.all|length }}/{{ object.limit }}{% if user.is_authenticated %}:
                    {% for reg in object.registration_set.all %}{% if not forloop.first %},{% endif %} {{ reg.user.first_name }}
                    {% endfor %}
                {% endif %}
            </p>
        {% endif %}
    </div>

    <div class="row">
        <p>
            {% if object.registration_start and object.registration_start > now %}
                {% trans "registrations open at"|capfirst %} {{ object.registration_start }}
            {% elif object.registration_start and object.registration_start < now and object.registration_end and object.registration_end > now %}
                {% trans "registrations close at"|capfirst %} {{ object.registration_end }}
            {% endif %}
        </p>
    </div>

{% endblock content %}